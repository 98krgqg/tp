
-- æœåŠ¡
local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")
local TeleportService = game:GetService("TeleportService")
local HttpService = game:GetService("HttpService")

-- æœ¬åœ°ç©å®¶
local LocalPlayer = Players.LocalPlayer
local Character = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
local HumanoidRootPart = Character:WaitForChild("HumanoidRootPart")

-- é…ç½® (å¯è‡ªå®šä¹‰)
local Config = {
    TeleportSpeed = 200,         -- ä¼ é€é€Ÿåº¦ (è¶Šå¤§è¶Šå¿«)
    TeleportHeight = 3,          -- é«˜åº¦åç§»
    Smoothness = 0.15,           -- å¹³æ»‘åº¦ (0-1, è¶Šå°è¶Šå¹³æ»‘)
    UpdateRate = 0.016,          -- æ›´æ–°é¢‘ç‡ (ç§’)
    ShowDistance = true,         -- æ˜¾ç¤ºè·ç¦»
    AutoRespawn = true,          -- è‡ªåŠ¨é‡ç”Ÿåé‡æ–°å¼€å§‹
    UseCFrameMethod = true,      -- ä½¿ç”¨CFrameæ–¹æ³• (æ›´ç¨³å®š)
    DebugMode = false           -- è°ƒè¯•æ¨¡å¼
}

-- çŠ¶æ€å˜é‡
local Teleporting = false
local TargetPlayer = nil
local PlayersList = {}
local CurrentIndex = 1
local UI = nil
local MainLoop = nil
local UIFolded = false -- UIæ”¶èµ·/å±•å¼€çŠ¶æ€

-- å·¥å…·å‡½æ•°
local function PrintDebug(msg)
    if Config.DebugMode then
        print("[ä¼ é€è°ƒè¯•]: " .. msg)
    end
end

local function ShowNotification(title, text, duration)
    game:GetService("StarterGui"):SetCore("SendNotification", {
        Title = title,
        Text = text,
        Duration = duration or 3,
        Icon = "rbxassetid://4483345998"
    })
end

-- è®¡ç®—ç©å®¶é—´çš„è·ç¦»
local function GetDistance(player1, player2)
    if not player1.Character or not player2.Character then
        return math.huge
    end
    
    local hrp1 = player1.Character:FindFirstChild("HumanoidRootPart")
    local hrp2 = player2.Character:FindFirstChild("HumanoidRootPart")
    
    if not hrp1 or not hrp2 then
        return math.huge
    end
    
    return (hrp1.Position - hrp2.Position).Magnitude
end

-- è·å–æ‰€æœ‰åœ¨çº¿ç©å®¶ï¼ˆæ’é™¤è‡ªå·±ï¼‰
local function GetOnlinePlayers()
    local players = {}
    for _, player in ipairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Character then
            table.insert(players, player)
        end
    end
    return players
end

-- å¿«é€Ÿå¹³æ»‘ä¼ é€å‡½æ•° (æ”¹è¿›ç‰ˆ)
local function FastSmoothTeleport(targetCFrame)
    if not HumanoidRootPart then return end
    
    local startCFrame = HumanoidRootPart.CFrame
    local startTime = tick()
    local duration = (targetCFrame.Position - startCFrame.Position).Magnitude / Config.TeleportSpeed
    
    -- ç¡®ä¿æœ€å°æŒç»­æ—¶é—´
    duration = math.max(duration, 0.1)
    
    -- å¿«é€Ÿå¹³æ»‘ç§»åŠ¨ (ä½¿ç”¨çº¿æ€§æ’å€¼ + ç¼“åŠ¨)
    local t = 0
    while t < 1 and Teleporting do
        t = (tick() - startTime) / duration
        
        -- ä½¿ç”¨ç«‹æ–¹ç¼“åŠ¨å‡½æ•°è·å¾—æ›´å¹³æ»‘çš„å¼€å§‹å’Œç»“æŸ
        local easeT = t * t * (3 - 2 * t)
        
        -- çº¿æ€§æ’å€¼ä½ç½®å’Œæœå‘
        local newPosition = startCFrame.Position:Lerp(targetCFrame.Position, easeT)
        local newLookVector = startCFrame.LookVector:Lerp(targetCFrame.LookVector, easeT)
        
        -- è®¾ç½®æ–°çš„CFrame
        HumanoidRootPart.CFrame = CFrame.new(newPosition, newPosition + newLookVector)
        
        RunService.RenderStepped:Wait()
    end
    
    -- æœ€ç»ˆä½ç½®
    if Teleporting then
        HumanoidRootPart.CFrame = targetCFrame
    end
end

-- æ›´å¿«çš„ç›´çº¿ä¼ é€ (æ— å¹³æ»‘æ•ˆæœ)
local function DirectTeleport(targetCFrame)
    if not HumanoidRootPart then return end
    HumanoidRootPart.CFrame = targetCFrame
end

-- å¸¦é¢„æµ‹çš„å¿«é€Ÿä¼ é€ (æœ€å¿«)
local function PredictiveTeleport(targetPlayer)
    if not HumanoidRootPart or not targetPlayer.Character then return end
    
    local targetHRP = targetPlayer.Character:FindFirstChild("HumanoidRootPart")
    if not targetHRP then return end
    
    -- è®¡ç®—ç›®æ ‡é€Ÿåº¦ (å¦‚æœå¯ç”¨)
    local targetVelocity = Vector3.new(0, 0, 0)
    if targetHRP:FindFirstChild("Velocity") then
        targetVelocity = targetHRP.Velocity
    end
    
    -- é¢„æµ‹ä½ç½® (åŸºäºé€Ÿåº¦å’Œæ›´æ–°æ—¶é—´)
    local predictionTime = Config.UpdateRate * 2
    local predictedPosition = targetHRP.Position + (targetVelocity * predictionTime)
    
    -- æ·»åŠ é«˜åº¦åç§»
    predictedPosition = predictedPosition + Vector3.new(0, Config.TeleportHeight, 0)
    
    -- ç›´æ¥ä¼ é€åˆ°é¢„æµ‹ä½ç½®
    HumanoidRootPart.CFrame = CFrame.new(predictedPosition, predictedPosition + Vector3.new(0, 0, 1))
end

-- ä¼ é€å¾ªç¯ä¸»å‡½æ•°
local function TeleportLoop()
    while Teleporting and RunService.Heartbeat:Wait() do
        if not TargetPlayer or not TargetPlayer.Character then
            PrintDebug("ç›®æ ‡ä¸¢å¤±")
            break
        end
        
        local targetChar = TargetPlayer.Character
        local targetHRP = targetChar:FindFirstChild("HumanoidRootPart")
        
        if not targetHRP then
            task.wait(0.1)
            continue
        end
        
        -- è®¡ç®—ç›®æ ‡CFrame
        local targetPosition = targetHRP.Position + Vector3.new(0, Config.TeleportHeight, 0)
        local lookVector = (targetPosition - HumanoidRootPart.Position).Unit
        local targetCFrame = CFrame.new(targetPosition, targetPosition + lookVector)
        
        -- é€‰æ‹©ä¼ é€æ–¹æ³•
        if Config.UseCFrameMethod then
            -- æ–¹æ³•1: ç›´æ¥ä¼ é€ (æœ€å¿«)
            DirectTeleport(targetCFrame)
        else
            -- æ–¹æ³•2: å¿«é€Ÿå¹³æ»‘ä¼ é€
            FastSmoothTeleport(targetCFrame)
        end
        
        -- æ–¹æ³•3: é¢„æµ‹ä¼ é€ (éœ€è¦æ—¶å¯å¯ç”¨)
        -- PredictiveTeleport(TargetPlayer)
        
        -- ç­‰å¾…æ›´æ–°é—´éš”
        task.wait(Config.UpdateRate)
    end
end

-- åˆ›å»ºä¼˜åŒ–ç‰ˆUI (å«ç½²å+å…¨è®¾å¤‡æ‹–åŠ¨)
local function CreateOptimizedUI()
    -- é”€æ¯ç°æœ‰UI
    if UI then
        UI:Destroy()
        UI = nil
    end
    
    -- åˆ›å»ºä¸»GUI
    local ScreenGui = Instance.new("ScreenGui")
    ScreenGui.Name = "FastTeleportUI_" .. HttpService:GenerateGUID(false)
    ScreenGui.Parent = game:GetService("CoreGui")
    -- å…³é”®ï¼šå…è®¸æ‰‹æœºè§¦æ‘¸ç©¿é€ï¼ˆä½†ä¸å½±å“æ‹–åŠ¨ï¼‰
    ScreenGui.IgnoreGuiInset = true
    ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    
    -- ä¸»å®¹å™¨ (ç¼©å°å°ºå¯¸: åŸ350x400 â†’ 250x300)
    local MainFrame = Instance.new("Frame")
    MainFrame.Size = UDim2.new(0, 250, 0, 300) -- æ ¸å¿ƒç¼©å°ç‚¹
    MainFrame.Position = UDim2.new(0.5, -125, 0.5, -150)
    MainFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 30)
    MainFrame.BorderSizePixel = 0
    MainFrame.ClipsDescendants = true
    MainFrame.Parent = ScreenGui
    
    -- æ”¶èµ·çŠ¶æ€çš„å°é¢æ¿ (ä»…æ˜¾ç¤ºæ ‡é¢˜+æ”¶èµ·/å±•å¼€æŒ‰é’®+ç½²å)
    local FoldFrame = Instance.new("Frame")
    FoldFrame.Size = UDim2.new(0, 250, 0, 40)
    FoldFrame.Position = UDim2.new(0, 0, 0, 0)
    FoldFrame.BackgroundColor3 = Color3.fromRGB(35, 35, 40)
    FoldFrame.BorderSizePixel = 0
    FoldFrame.Visible = false
    FoldFrame.Parent = MainFrame
    
    -- åœ†è§’
    local MainCorner = Instance.new("UICorner")
    MainCorner.CornerRadius = UDim.new(0, 8)
    MainCorner.Parent = MainFrame
    
    local FoldCorner = Instance.new("UICorner")
    FoldCorner.CornerRadius = UDim.new(0, 8)
    FoldCorner.Parent = FoldFrame
    
    -- æ ‡é¢˜æ  (é€‚é…å°å°ºå¯¸ + æ–°å¢ç½²å)
    local TitleBar = Instance.new("Frame")
    TitleBar.Size = UDim2.new(1, 0, 0, 40)
    TitleBar.BackgroundColor3 = Color3.fromRGB(35, 35, 40)
    TitleBar.BorderSizePixel = 0
    TitleBar.Parent = MainFrame
    
    local TitleCorner = Instance.new("UICorner")
    TitleCorner.CornerRadius = UDim.new(0, 8)
    TitleCorner.Parent = TitleBar
    
    -- ä¸»æ ‡é¢˜
    local Title = Instance.new("TextLabel")
    Title.Size = UDim2.new(1, -120, 0, 22) -- ç•™å‡ºç½²åç©ºé—´
    Title.Position = UDim2.new(0, 10, 0, 0)
    Title.BackgroundTransparency = 1
    Title.Text = "ğŸš€ å¿«é€Ÿä¼ é€å™¨"
    Title.TextColor3 = Color3.fromRGB(255, 255, 255)
    Title.Font = Enum.Font.GothamBold
    Title.TextSize = 16 -- ç¼©å°å­—ä½“
    Title.TextXAlignment = Enum.TextXAlignment.Left
    Title.Parent = TitleBar

    -- æ–°å¢ç½²åæ ‡ç­¾ (by 98krgqg)
    local AuthorLabel = Instance.new("TextLabel")
    AuthorLabel.Size = UDim2.new(1, -120, 0, 18)
    AuthorLabel.Position = UDim2.new(0, 10, 0, 22)
    AuthorLabel.BackgroundTransparency = 1
    AuthorLabel.Text = "by 98krgqg"
    AuthorLabel.TextColor3 = Color3.fromRGB(180, 180, 180) -- æµ…ç°è‰²ï¼Œä¸åˆºçœ¼
    AuthorLabel.Font = Enum.Font.Gotham
    AuthorLabel.TextSize = 10 -- å°å­—ä½“ï¼Œä¸å ç©ºé—´
    AuthorLabel.TextXAlignment = Enum.TextXAlignment.Left
    AuthorLabel.Parent = TitleBar

    -- æ”¶èµ·/å±•å¼€æŒ‰é’® (æ ¸å¿ƒæ–°å¢)
    local FoldButton = Instance.new("TextButton")
    FoldButton.Size = UDim2.new(0, 30, 0, 30)
    FoldButton.Position = UDim2.new(1, -35, 0, 5)
    FoldButton.BackgroundColor3 = Color3.fromRGB(70, 70, 80)
    FoldButton.Text = "âˆ’" -- åˆå§‹å±•å¼€çŠ¶æ€æ˜¾ç¤ºå‡å·
    FoldButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    FoldButton.Font = Enum.Font.GothamBold
    FoldButton.TextSize = 18
    FoldButton.Parent = TitleBar
    
    local FoldBtnCorner = Instance.new("UICorner")
    FoldBtnCorner.CornerRadius = UDim.new(0, 15)
    FoldBtnCorner.Parent = FoldButton

    -- æ”¶èµ·é¢æ¿çš„æ ‡é¢˜å’Œå±•å¼€æŒ‰é’® + ç½²å
    local FoldTitle = Instance.new("TextLabel")
    FoldTitle.Size = UDim2.new(1, -80, 0, 22) -- ç•™å‡ºç½²åç©ºé—´
    FoldTitle.Position = UDim2.new(0, 10, 0, 0)
    FoldTitle.BackgroundTransparency = 1
    FoldTitle.Text = "Bypasstp
    FoldTitle.TextColor3 = Color3.fromRGB(255, 255, 255)
    FoldTitle.Font = Enum.Font.GothamBold
    FoldTitle.TextSize = 16
    FoldTitle.TextXAlignment = Enum.TextXAlignment.Left
    FoldTitle.Parent = FoldFrame

    -- æ”¶èµ·é¢æ¿çš„ç½²å
    local FoldAuthorLabel = Instance.new("TextLabel")
    FoldAuthorLabel.Size = UDim2.new(1, -80, 0, 18)
    FoldAuthorLabel.Position = UDim2.new(0, 10, 0, 22)
    FoldAuthorLabel.BackgroundTransparency = 1
    FoldAuthorLabel.Text = "by 98krgqg"
    FoldAuthorLabel.TextColor3 = Color3.fromRGB(180, 180, 180)
    FoldAuthorLabel.Font = Enum.Font.Gotham
    FoldAuthorLabel.TextSize = 10
    FoldAuthorLabel.TextXAlignment = Enum.TextXAlignment.Left
    FoldAuthorLabel.Parent = FoldFrame

    local UnfoldButton = Instance.new("TextButton")
    UnfoldButton.Size = UDim2.new(0, 30, 0, 30)
    UnfoldButton.Position = UDim2.new(1, -35, 0, 5)
    UnfoldButton.BackgroundColor3 = Color3.fromRGB(70, 70, 80)
    UnfoldButton.Text = "+" -- æ”¶èµ·çŠ¶æ€æ˜¾ç¤ºåŠ å·
    UnfoldButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    UnfoldButton.Font = Enum.Font.GothamBold
    UnfoldButton.TextSize = 18
    UnfoldButton.Parent = FoldFrame
    
    local UnfoldBtnCorner = Instance.new("UICorner")
    UnfoldBtnCorner.CornerRadius = UDim.new(0, 15)
    UnfoldBtnCorner.Parent = UnfoldButton
    
    -- å…³é—­æŒ‰é’® (ç¼©å°å°ºå¯¸)
    local CloseButton = Instance.new("TextButton")
    CloseButton.Size = UDim2.new(0, 25, 0, 25) -- ç¼©å°
    CloseButton.Position = UDim2.new(1, -65, 0, 7)
    CloseButton.BackgroundColor3 = Color3.fromRGB(200, 60, 60)
    CloseButton.Text = "Ã—"
    CloseButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    CloseButton.Font = Enum.Font.GothamBold
    CloseButton.TextSize = 16
    CloseButton.Parent = TitleBar
    
    local CloseCorner = Instance.new("UICorner")
    CloseCorner.CornerRadius = UDim.new(0, 12)
    CloseCorner.Parent = CloseButton
    
    -- æœç´¢æ¡† (ç¼©å°å°ºå¯¸)
    local SearchContainer = Instance.new("Frame")
    SearchContainer.Size = UDim2.new(1, -20, 0, 35) -- ç¼©å°
    SearchContainer.Position = UDim2.new(0, 10, 0, 45)
    SearchContainer.BackgroundColor3 = Color3.fromRGB(40, 40, 45)
    SearchContainer.BorderSizePixel = 0
    SearchContainer.Parent = MainFrame
    
    local SearchCorner = Instance.new("UICorner")
    SearchCorner.CornerRadius = UDim.new(0, 6)
    SearchCorner.Parent = SearchContainer
    
    local SearchBox = Instance.new("TextBox")
    SearchBox.Size = UDim2.new(1, -40, 1, 0)
    SearchBox.Position = UDim2.new(0, 8, 0, 0)
    SearchBox.BackgroundTransparency = 1
    SearchBox.Text = "æœç´¢ç©å®¶..."
    SearchBox.PlaceholderText = "è¾“å…¥åç§°"
    SearchBox.TextColor3 = Color3.fromRGB(200, 200, 200)
    SearchBox.Font = Enum.Font.Gotham
    SearchBox.TextSize = 12 -- ç¼©å°å­—ä½“
    SearchBox.TextXAlignment = Enum.TextXAlignment.Left
    SearchBox.ClearTextOnFocus = false
    SearchBox.Parent = SearchContainer
    
    local SearchIcon = Instance.new("ImageLabel")
    SearchIcon.Size = UDim2.new(0, 16, 0, 16) -- ç¼©å°
    SearchIcon.Position = UDim2.new(1, -25, 0.5, -8)
    SearchIcon.BackgroundTransparency = 1
    SearchIcon.Image = "rbxassetid://3926305904"
    SearchIcon.ImageRectOffset = Vector2.new(964, 324)
    SearchIcon.ImageRectSize = Vector2.new(36, 36)
    SearchIcon.ImageColor3 = Color3.fromRGB(150, 150, 150)
    SearchIcon.Parent = SearchContainer
    
    -- ç©å®¶åˆ—è¡¨å®¹å™¨ (ç¼©å°å°ºå¯¸)
    local ListContainer = Instance.new("ScrollingFrame")
    ListContainer.Size = UDim2.new(1, -20, 0, 140) -- ç¼©å°
    ListContainer.Position = UDim2.new(0, 10, 0, 85)
    ListContainer.BackgroundColor3 = Color3.fromRGB(30, 30, 35)
    ListContainer.BorderSizePixel = 0
    ListContainer.ScrollBarThickness = 3 -- ç¼©å°æ»šåŠ¨æ¡
    ListContainer.ScrollBarImageColor3 = Color3.fromRGB(100, 100, 100)
    ListContainer.CanvasSize = UDim2.new(0, 0, 0, 0)
    ListContainer.AutomaticCanvasSize = Enum.AutomaticSize.Y
    ListContainer.Parent = MainFrame
    
    local ListLayout = Instance.new("UIListLayout")
    ListLayout.Padding = UDim.new(0, 4) -- ç¼©å°é—´è·
    ListLayout.Parent = ListContainer
    
    -- æ§åˆ¶é¢æ¿ (ç¼©å°å°ºå¯¸)
    local ControlPanel = Instance.new("Frame")
    ControlPanel.Size = UDim2.new(1, -20, 0, 80) -- ç¼©å°
    ControlPanel.Position = UDim2.new(0, 10, 1, -90)
    ControlPanel.BackgroundColor3 = Color3.fromRGB(35, 35, 40)
    ControlPanel.BorderSizePixel = 0
    ControlPanel.Parent = MainFrame
    
    local ControlCorner = Instance.new("UICorner")
    ControlCorner.CornerRadius = UDim.new(0, 8)
    ControlCorner.Parent = ControlPanel
    
    -- çŠ¶æ€æ˜¾ç¤º (ç¼©å°å­—ä½“)
    local StatusLabel = Instance.new("TextLabel")
    StatusLabel.Size = UDim2.new(1, -15, 0, 20) -- ç¼©å°
    StatusLabel.Position = UDim2.new(0, 8, 0, 8)
    StatusLabel.BackgroundTransparency = 1
    StatusLabel.Text = "çŠ¶æ€: å¾…æœº"
    StatusLabel.TextColor3 = Color3.fromRGB(200, 200, 100)
    StatusLabel.Font = Enum.Font.Gotham
    StatusLabel.TextSize = 12 -- ç¼©å°å­—ä½“
    StatusLabel.TextXAlignment = Enum.TextXAlignment.Left
    StatusLabel.Name = "StatusLabel"
    StatusLabel.Parent = ControlPanel
    
    local TargetLabel = Instance.new("TextLabel")
    TargetLabel.Size = UDim2.new(1, -15, 0, 18) -- ç¼©å°
    TargetLabel.Position = UDim2.new(0, 8, 0, 28)
    TargetLabel.BackgroundTransparency = 1
    TargetLabel.Text = "ç›®æ ‡: æ— "
    TargetLabel.TextColor3 = Color3.fromRGB(170, 170, 255)
    TargetLabel.Font = Enum.Font.Gotham
    TargetLabel.TextSize = 11 -- ç¼©å°å­—ä½“
    TargetLabel.TextXAlignment = Enum.TextXAlignment.Left
    TargetLabel.Name = "TargetLabel"
    TargetLabel.Parent = ControlPanel
    
    local DistanceLabel = Instance.new("TextLabel")
    DistanceLabel.Size = UDim2.new(1, -15, 0, 18) -- ç¼©å°
    DistanceLabel.Position = UDim2.new(0, 8, 0, 46)
    DistanceLabel.BackgroundTransparency = 1
    DistanceLabel.Text = "è·ç¦»: -"
    DistanceLabel.TextColor3 = Color3.fromRGB(150, 255, 150)
    DistanceLabel.Font = Enum.Font.Gotham
    DistanceLabel.TextSize = 11 -- ç¼©å°å­—ä½“
    DistanceLabel.TextXAlignment = Enum.TextXAlignment.Left
    DistanceLabel.Name = "DistanceLabel"
    DistanceLabel.Parent = ControlPanel
    
    -- æ§åˆ¶æŒ‰é’® (ç¼©å°å°ºå¯¸)
    local StartButton = Instance.new("TextButton")
    StartButton.Size = UDim2.new(0.47, 0, 0, 30) -- ç¼©å°
    StartButton.Position = UDim2.new(0, 8, 1, -38)
    StartButton.BackgroundColor3 = Color3.fromRGB(60, 180, 60)
    StartButton.Text = "â–¶ å¼€å§‹"
    StartButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    StartButton.Font = Enum.Font.GothamBold
    StartButton.TextSize = 12 -- ç¼©å°å­—ä½“
    StartButton.Parent = ControlPanel
    
    local StopButton = Instance.new("TextButton")
    StopButton.Size = UDim2.new(0.47, 0, 0, 30) -- ç¼©å°
    StopButton.Position = UDim2.new(0.53, 8, 1, -38)
    StopButton.BackgroundColor3 = Color3.fromRGB(180, 60, 60)
    StopButton.Text = "â–  åœæ­¢"
    StopButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    StopButton.Font = Enum.Font.GothamBold
    StopButton.TextSize = 12 -- ç¼©å°å­—ä½“
    StopButton.Parent = ControlPanel
    
    -- æŒ‰é’®åœ†è§’
    local ButtonCorner1 = Instance.new("UICorner")
    ButtonCorner1.CornerRadius = UDim.new(0, 5)
    ButtonCorner1.Parent = StartButton
    
    local ButtonCorner2 = Instance.new("UICorner")
    ButtonCorner2.CornerRadius = UDim.new(0, 5)
    ButtonCorner2.Parent = StopButton
    
    -- ====================== å…¨è®¾å¤‡æ‹–åŠ¨é€»è¾‘ (æ ¸å¿ƒé‡æ„) ======================
    local isDragging = false
    local dragStartPos = Vector2.new(0, 0)
    local frameStartPos = UDim2.new(0, 0, 0, 0)

    -- å¤„ç†è¾“å…¥å¼€å§‹ï¼ˆå…¼å®¹é¼ æ ‡+è§¦æ‘¸ï¼‰
    local function handleInputBegan(input, gameProcessed)
        if gameProcessed then return end -- å¿½ç•¥æ¸¸æˆå·²å¤„ç†çš„è¾“å…¥ï¼ˆæ¯”å¦‚æ‰“å­—ï¼‰
        
        -- åˆ¤å®šæ˜¯å¦ä¸ºæœ‰æ•ˆæ‹–åŠ¨èµ·ç‚¹ï¼šé¼ æ ‡å·¦é”® æˆ– è§¦æ‘¸
        local isLeftClick = input.UserInputType == Enum.UserInputType.MouseButton1
        local isTouch = input.UserInputType == Enum.UserInputType.Touch
        
        if (isLeftClick or isTouch) then
            -- æ£€æŸ¥æ˜¯å¦ç‚¹å‡»åœ¨æ ‡é¢˜æ /æ”¶èµ·é¢æ¿ä¸Š
            local clickPos = input.Position
            local titleBarPos = TitleBar.AbsolutePosition
            local titleBarSize = TitleBar.AbsoluteSize
            local foldFramePos = FoldFrame.AbsolutePosition
            local foldFrameSize = FoldFrame.AbsoluteSize
            
            local hitTitleBar = (
                clickPos.X >= titleBarPos.X and clickPos.X <= titleBarPos.X + titleBarSize.X and
                clickPos.Y >= titleBarPos.Y and clickPos.Y <= titleBarPos.Y + titleBarSize.Y
            )
            
            local hitFoldFrame = (
                FoldFrame.Visible and
                clickPos.X >= foldFramePos.X and clickPos.X <= foldFramePos.X + foldFrameSize.X and
                clickPos.Y >= foldFramePos.Y and clickPos.Y <= foldFramePos.Y + foldFrameSize.Y
            )
            
            if hitTitleBar or hitFoldFrame then
                isDragging = true
                dragStartPos = clickPos
                frameStartPos = MainFrame.Position
            end
        end
    end

    -- å¤„ç†è¾“å…¥ç§»åŠ¨ï¼ˆå…¼å®¹é¼ æ ‡+è§¦æ‘¸ï¼‰
    local function handleInputChanged(input, gameProcessed)
        if gameProcessed or not isDragging then return end
        
        -- é¼ æ ‡ç§»åŠ¨ æˆ– è§¦æ‘¸ç§»åŠ¨
        local isMouseMove = input.UserInputType == Enum.UserInputType.MouseMovement
        local isTouchMove = input.UserInputType == Enum.UserInputType.Touch
        
        if (isMouseMove or isTouchMove) then
            local currentPos = input.Position
            local deltaX = currentPos.X - dragStartPos.X
            local deltaY = currentPos.Y - dragStartPos.Y
            
            -- æ›´æ–°UIä½ç½®
            MainFrame.Position = UDim2.new(
                frameStartPos.X.Scale,
                frameStartPos.X.Offset + deltaX,
                frameStartPos.Y.Scale,
                frameStartPos.Y.Offset + deltaY
            )
        end
    end

    -- å¤„ç†è¾“å…¥ç»“æŸï¼ˆå…¼å®¹é¼ æ ‡+è§¦æ‘¸ï¼‰
    local function handleInputEnded(input, gameProcessed)
        if gameProcessed then return end
        
        local isLeftClickEnd = input.UserInputType == Enum.UserInputType.MouseButton1
        local isTouchEnd = input.UserInputType == Enum.UserInputType.Touch
        
        if (isLeftClickEnd or isTouchEnd) then
            isDragging = false
        end
    end

    -- ç»‘å®šå…¨å±€è¾“å…¥äº‹ä»¶
    UserInputService.InputBegan:Connect(handleInputBegan)
    UserInputService.InputChanged:Connect(handleInputChanged)
    UserInputService.InputEnded:Connect(handleInputEnded)
    -- ====================== æ‹–åŠ¨é€»è¾‘é‡æ„ç»“æŸ ======================
    
    -- æ”¶èµ·/å±•å¼€é€»è¾‘ (æ ¸å¿ƒæ–°å¢)
    local function ToggleFold()
        UIFolded = not UIFolded
        
        if UIFolded then
            -- æ”¶èµ·çŠ¶æ€: éšè—ä¸»å†…å®¹ï¼Œæ˜¾ç¤ºå°é¢æ¿
            TitleBar.Visible = false
            SearchContainer.Visible = false
            ListContainer.Visible = false
            ControlPanel.Visible = false
            FoldFrame.Visible = true
            MainFrame.Size = UDim2.new(0, 250, 0, 40) -- ä»…æ˜¾ç¤ºå°é¢æ¿
            FoldButton.Text = "+"
        else
            -- å±•å¼€çŠ¶æ€: æ˜¾ç¤ºæ‰€æœ‰å†…å®¹ï¼Œæ¢å¤åŸå°ºå¯¸
            FoldFrame.Visible = false
            TitleBar.Visible = true
            SearchContainer.Visible = true
            ListContainer.Visible = true
            ControlPanel.Visible = true
            MainFrame.Size = UDim2.new(0, 250, 0, 300) -- æ¢å¤ç¼©å°åçš„å°ºå¯¸
            FoldButton.Text = "âˆ’"
        end
    end

    -- ç»‘å®šæ”¶èµ·/å±•å¼€æŒ‰é’®
    FoldButton.MouseButton1Click:Connect(ToggleFold)
    UnfoldButton.MouseButton1Click:Connect(ToggleFold)
    
    -- æŒ‰é’®äº‹ä»¶
    CloseButton.MouseButton1Click:Connect(function()
        ScreenGui:Destroy()
        UI = nil
    end)
    
    StartButton.MouseButton1Click:Connect(function()
        if TargetPlayer then
            StartTeleport()
        else
            ShowNotification("é”™è¯¯", "è¯·å…ˆé€‰æ‹©ç›®æ ‡ç©å®¶", 2)
        end
    end)
    
    StopButton.MouseButton1Click:Connect(function()
        StopTeleport()
    end)
    
    -- æœç´¢åŠŸèƒ½ (ä¿ç•™åŸæœ‰é€»è¾‘)
    local function FilterPlayers(searchText)
        local players = GetOnlinePlayers()
        local filtered = {}
        
        if searchText == "" or searchText == "æœç´¢ç©å®¶..." then
            return players
        end
        
        for _, player in ipairs(players) do
            if string.find(string.lower(player.Name), string.lower(searchText)) then
                table.insert(filtered, player)
            end
        end
        
        return filtered
    end
    
    SearchBox.FocusLost:Connect(function(enterPressed)
        UpdatePlayerList()
    end)
    
    SearchBox:GetPropertyChangedSignal("Text"):Connect(function()
        UpdatePlayerList()
    end)
    
    -- æ›´æ–°ç©å®¶åˆ—è¡¨å‡½æ•° (é€‚é…å°å°ºå¯¸)
    local function UpdatePlayerList()
        -- æ¸…é™¤ç°æœ‰é¡¹
        for _, child in ipairs(ListContainer:GetChildren()) do
            if child:IsA("Frame") then
                child:Destroy()
            end
        end
        
        -- è·å–è¿‡æ»¤åçš„ç©å®¶
        local searchText = SearchBox.Text
        PlayersList = FilterPlayers(searchText)
        
        -- åˆ›å»ºç©å®¶é¡¹ (ç¼©å°å°ºå¯¸)
        for _, player in ipairs(PlayersList) do
            local PlayerItem = Instance.new("Frame")
            PlayerItem.Size = UDim2.new(1, 0, 0, 40) -- ç¼©å°
            PlayerItem.BackgroundColor3 = Color3.fromRGB(40, 40, 45)
            PlayerItem.BorderSizePixel = 0
            PlayerItem.Name = player.Name
            PlayerItem.Parent = ListContainer
            
            local ItemCorner = Instance.new("UICorner")
            ItemCorner.CornerRadius = UDim.new(0, 5)
            ItemCorner.Parent = PlayerItem
            
            local PlayerName = Instance.new("TextLabel")
            PlayerName.Size = UDim2.new(1, -50, 0, 20) -- ç¼©å°
            PlayerName.Position = UDim2.new(0, 8, 0, 4)
            PlayerName.BackgroundTransparency = 1
            PlayerName.Text = player.Name
            PlayerName.TextColor3 = Color3.fromRGB(255, 255, 255)
            PlayerName.Font = Enum.Font.GothamBold
            PlayerName.TextSize = 14 -- ç¼©å°å­—ä½“
            PlayerName.TextXAlignment = Enum.TextXAlignment.Left
            PlayerName.Parent = PlayerItem
            
            local PlayerDisplay = Instance.new("TextLabel")
            PlayerDisplay.Size = UDim2.new(1, -50, 0, 16) -- ç¼©å°
            PlayerDisplay.Position = UDim2.new(0, 8, 0, 24)
            PlayerDisplay.BackgroundTransparency = 1
            PlayerDisplay.Text = "@" .. player.DisplayName
            PlayerDisplay.TextColor3 = Color3.fromRGB(180, 180, 180)
            PlayerDisplay.Font = Enum.Font.Gotham
            PlayerDisplay.TextSize = 10 -- ç¼©å°å­—ä½“
            PlayerDisplay.TextXAlignment = Enum.TextXAlignment.Left
            PlayerDisplay.Parent = PlayerItem
            
            local SelectButton = Instance.new("TextButton")
            SelectButton.Size = UDim2.new(0, 35, 0, 30) -- ç¼©å°
            SelectButton.Position = UDim2.new(1, -43, 0.5, -15)
            SelectButton.BackgroundColor3 = Color3.fromRGB(70, 70, 180)
            SelectButton.Text = "é€‰"
            SelectButton.TextColor3 = Color3.fromRGB(255, 255, 255)
            SelectButton.Font = Enum.Font.Gotham
            SelectButton.TextSize = 11 -- ç¼©å°å­—ä½“
            SelectButton.Parent = PlayerItem
            
            local SelectCorner = Instance.new("UICorner")
            SelectCorner.CornerRadius = UDim.new(0, 5)
            SelectCorner.Parent = SelectButton
            
            -- é€‰ä¸­çŠ¶æ€æŒ‡ç¤ºå™¨
            local SelectedIndicator = Instance.new("Frame")
            SelectedIndicator.Size = UDim2.new(1, 0, 0, 2) -- ç¼©å°
            SelectedIndicator.Position = UDim2.new(0, 0, 1, -2)
            SelectedIndicator.BackgroundColor3 = Color3.fromRGB(100, 200, 255)
            SelectedIndicator.BorderSizePixel = 0
            SelectedIndicator.Visible = (player == TargetPlayer)
            SelectedIndicator.Name = "SelectedIndicator"
            SelectedIndicator.Parent = PlayerItem
            
            -- é€‰æ‹©æŒ‰é’®ç‚¹å‡»äº‹ä»¶
            SelectButton.MouseButton1Click:Connect(function()
                TargetPlayer = player
                UpdatePlayerList() -- æ›´æ–°é€‰æ‹©çŠ¶æ€
                UpdateUIStatus()
                ShowNotification("ç›®æ ‡å·²é€‰æ‹©", "å½“å‰ç›®æ ‡: " .. player.Name, 2)
            end)
        end
    end
    
    -- æ›´æ–°UIçŠ¶æ€å‡½æ•° (é€‚é…æ”¶èµ·/å±•å¼€)
    local function UpdateUIStatus()
        if StatusLabel then
            StatusLabel.Text = "çŠ¶æ€: " .. (Teleporting and "ä¼ é€ä¸­" or "å¾…æœº")
            StatusLabel.TextColor3 = Teleporting and Color3.fromRGB(100, 255, 100) or Color3.fromRGB(200, 200, 100)
        end
        
        if TargetLabel then
            TargetLabel.Text = "ç›®æ ‡: " .. (TargetPlayer and TargetPlayer.Name or "æ— ")
        end
        
        if DistanceLabel and TargetPlayer and Config.ShowDistance then
            local distance = GetDistance(LocalPlayer, TargetPlayer)
            DistanceLabel.Text = "è·ç¦»: " .. string.format("%.1f", distance) .. " ç±³"
        end
        
        -- æ›´æ–°åˆ—è¡¨ä¸­çš„é€‰ä¸­çŠ¶æ€
        for _, child in ipairs(ListContainer:GetChildren()) do
            if child:IsA("Frame") then
                local indicator = child:FindFirstChild("SelectedIndicator")
                if indicator then
                    indicator.Visible = (child.Name == (TargetPlayer and TargetPlayer.Name or ""))
                end
            end
        end
    end
    
    -- åˆå§‹åŒ–
    UpdatePlayerList()
    UpdateUIStatus()
    
    -- å®šæ—¶æ›´æ–°è·ç¦»
    local distanceUpdate = RunService.Heartbeat:Connect(function()
        if TargetPlayer and Config.ShowDistance and DistanceLabel then
            local distance = GetDistance(LocalPlayer, TargetPlayer)
            DistanceLabel.Text = "è·ç¦»: " .. string.format("%.1f", distance) .. " ç±³"
        end
    end)
    
    -- ç©å®¶åŠ å…¥/ç¦»å¼€äº‹ä»¶
    local function OnPlayerAdded(player)
        task.wait(1) -- ç­‰å¾…ç©å®¶åŠ è½½
        UpdatePlayerList()
    end
    
    local function OnPlayerRemoving(player)
        if player == TargetPlayer then
            TargetPlayer = nil
            if Teleporting then
                StopTeleport()
                ShowNotification("ç›®æ ‡ä¸¢å¤±", "ç›®æ ‡ç©å®¶å·²ç¦»å¼€", 2)
            end
        end
        UpdatePlayerList()
    end
    
    Players.PlayerAdded:Connect(OnPlayerAdded)
    Players.PlayerRemoving:Connect(OnPlayerRemoving)
    
    -- è¿”å›UIå’Œæ›´æ–°å‡½æ•°
    return ScreenGui, UpdateUIStatus, UpdatePlayerList
end

-- å¼€å§‹ä¼ é€
function StartTeleport()
    if not TargetPlayer then
        ShowNotification("é”™è¯¯", "è¯·å…ˆé€‰æ‹©ç›®æ ‡ç©å®¶", 2)
        return
    end
    
    if not TargetPlayer.Character then
        ShowNotification("é”™è¯¯", "ç›®æ ‡ç©å®¶æ²¡æœ‰è§’è‰²", 2)
        return
    end
    
    if Teleporting then
        ShowNotification("æç¤º", "å·²ç»åœ¨ä¼ é€ä¸­", 2)
        return
    end
    
    Teleporting = true
    ShowNotification("ä¼ é€å¼€å§‹", "ç›®æ ‡: " .. TargetPlayer.Name, 2)
    
    -- å¯åŠ¨ä¼ é€å¾ªç¯
    MainLoop = RunService.Heartbeat:Connect(function()
        if not Teleporting or not TargetPlayer or not TargetPlayer.Character then
            if Teleporting then
                StopTeleport()
            end
            return
        end
        
        local targetChar = TargetPlayer.Character
        local targetHRP = targetChar:FindFirstChild("HumanoidRootPart")
        
        if not targetHRP then
            return
        end
        
        -- å¿«é€Ÿç›´æ¥ä¼ é€
        local targetPosition = targetHRP.Position + Vector3.new(0, Config.TeleportHeight, 0)
        local lookVector = (targetPosition - (HumanoidRootPart and HumanoidRootPart.Position or Vector3.new(0,0,0))).Unit
        local targetCFrame = CFrame.new(targetPosition, targetPosition + lookVector)
        
        if HumanoidRootPart then
            HumanoidRootPart.CFrame = targetCFrame
        end
    end)
    
    if UI then
        UpdateUIStatus()
    end
end

-- åœæ­¢ä¼ é€
function StopTeleport()
    if not Teleporting then
        return
    end
    
    Teleporting = false
    
    if MainLoop then
        MainLoop:Disconnect()
        MainLoop = nil
    end
    
    ShowNotification("ä¼ é€åœæ­¢", "å·²åœæ­¢ä¼ é€", 2)
    
    if UI then
        UpdateUIStatus()
    end
end

-- åˆå§‹åŒ–
task.wait(1) -- ç­‰å¾…å®Œå…¨åŠ è½½

-- åˆ›å»ºä¼˜åŒ–ç‰ˆUI
UI, UpdateUIStatus, UpdatePlayerList = CreateOptimizedUI()

-- æ˜¾ç¤ºæ¬¢è¿ä¿¡æ¯ (æ–°å¢ç½²åæç¤º)
ShowNotification("å¿«é€Ÿä¼ é€è„šæœ¬å·²åŠ è½½", 
    "åŠŸèƒ½è¯´æ˜:\n" ..
    "1. ä»åˆ—è¡¨é€‰æ‹©ç©å®¶\n" ..
    "2. ç‚¹å‡»å¼€å§‹/åœæ­¢ä¼ é€\n" ..
    "3. ç‚¹å‡»âˆ’/+/Ã—æ”¶èµ·/å±•å¼€/å…³é—­\n" ..
    "4. æ‹–åŠ¨æ ‡é¢˜æ /å°é¢æ¿å¯ç§»åŠ¨UI\n" ..
    "5. æ”¯æŒæ‰‹æœºè§¦æ‘¸æ‹–åŠ¨\n" ..
    "by 98krgqg | ä¼ é€é€Ÿåº¦: " .. Config.TeleportSpeed, 
    6
)

-- è§’è‰²é‡ç”Ÿå¤„ç†
LocalPlayer.CharacterAdded:Connect(function(newChar)
    Character = newChar
    task.wait(0.5) -- ç­‰å¾…è§’è‰²å®Œå…¨åŠ è½½
    HumanoidRootPart = newChar:WaitForChild("HumanoidRootPart")
    
    if Teleporting and Config.AutoRespawn then
        ShowNotification("è‡ªåŠ¨æ¢å¤", "è§’è‰²é‡ç”Ÿåç»§ç»­ä¼ é€", 2)
        task.wait(1)
        if TargetPlayer then
            Teleporting = true
        end
    end
end)

-- ä¸»å¾ªç¯
while task.wait(1) do
    if Teleporting and (not TargetPlayer or not TargetPlayer.Character) then
        StopTeleport()
    end
    
    -- æ¯5ç§’åˆ·æ–°ä¸€æ¬¡ç©å®¶åˆ—è¡¨
    if tick() % 5 < 1 then
        UpdatePlayerList()
    end
end
